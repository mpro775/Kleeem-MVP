%%{init: {"C4": {"theme": "base", "themeVariables": {
  "primaryColor": "#10b981",
  "primaryTextColor": "#000",
  "primaryBorderColor": "#000",
  "lineColor": "#333",
  "secondaryColor": "#f59e0b",
  "tertiaryColor": "#0ea5e9"
}}}}%%

C4Context
    title Kleem â€” System Context

    %% Layout: top = actors, middle = Kleem, bottom = externals
    %% Put people first (row 1), then Kleem boundary (row 2),
    %% then externals boundary (row 3).
    UpdateLayoutConfig($c4ShapeInRow="3", $c4BoundaryInRow="1")

    %% === TOP: Actors ===
    Person(merchant, "Merchant", "Manages store, settings, inbox")
    Person(shopper, "Shopper", "Chats with Kleem and purchases")
    Person(platform_admin, "Platform Admin", "Oversees the platform and global training")

    %% === MIDDLE: System (inside the enterprise boundary) ===
    Enterprise_Boundary(org, "Kleem Cloud") {
        System(kleem, "Kleem", "Conversational commerce platform + mini storefront")
    }

    %% === BOTTOM: External Systems ===
    Boundary(externals, "External Systems & Channels") {
        System_Ext(whatsapp, "WhatsApp Business API", "Messaging channel")
        System_Ext(telegram, "Telegram Bot API", "Messaging channel")
        System_Ext(salla, "Salla", "E-commerce platform")
        System_Ext(zid, "Zid", "E-commerce platform")
        System_Ext(shopify, "Shopify", "E-commerce platform")
        System_Ext(payment, "Payment Gateway", "Payments / checkout")
        System_Ext(llm, "LLM Provider", "AI inference")
        System_Ext(merchant_site, "Merchant Website", "Hosts the Web Chat widget")
    }

    %% === Relationships ===
    Rel(merchant, kleem, "Manage store & inbox", "HTTPS")
    Rel(shopper, kleem, "Chat & purchase", "HTTPS / WebSocket")
    Rel(platform_admin, kleem, "Administer & train", "HTTPS")

    BiRel(kleem, whatsapp, "Messages & statuses", "HTTPS")
    BiRel(kleem, telegram, "Messages & updates", "HTTPS")
    BiRel(kleem, salla, "Sync products & orders", "REST API")
    BiRel(kleem, zid, "Sync products & orders", "REST API")
    BiRel(kleem, shopify, "Sync products & orders", "REST API")
    Rel(kleem, payment, "Create payments / verify", "REST API")
    Rel(kleem, llm, "AI queries", "HTTPS")
    Rel(merchant_site, kleem, "Embed / serve chat widget", "JavaScript")

    %% === Styling (optional) ===
    UpdateElementStyle(merchant, $bgColor="#f59e0b", $fontColor="black")
    UpdateElementStyle(shopper, $bgColor="#f59e0b", $fontColor="black")
    UpdateElementStyle(platform_admin, $bgColor="#f59e0b", $fontColor="black")
    UpdateElementStyle(kleem, $bgColor="#10b981", $fontColor="white")
