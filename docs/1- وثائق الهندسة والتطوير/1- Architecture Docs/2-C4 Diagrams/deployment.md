# C4 ุงููุณุชูู 4 โ ูุฎุทุท ุงููุดุฑ
*ุขุฎุฑ ุชุญุฏูุซ: 2025-09-27 19:15*

> **ูุฎุทุท ูุดุฑ C4** โ ูุนุฑุถ ุทุจูููุฌูุง ุงููุดุฑ ูุงูุจูุฆุงุช ูุงูุญุฏูุฏ ุงูุฃูููุฉ ูููุธุงู. ูุฐุง ูู ุฃุนูู ูุณุชูู ูู ูููุฐุฌ C4 ุงูุฐู ูุฑูุฒ ุนูู ุงูุจููุฉ ุงูุชุญุชูุฉ ูุงูุนูููุงุช.

---

## ๐ฏ ุงูุบุฑุถ ูุงููุทุงู

**ุงูุบุฑุถ ุงูุฑุฆูุณู:** ุชูุถูุญ ููููุฉ ุชูุฒูุน ุงูุฎุฏูุงุช ุนูู ุงูุจูุฆุงุช ุงููุฎุชููุฉ (ุงูุชุทููุฑุ ุงูุงุฎุชุจุงุฑุ ุงูุฅูุชุงุฌ) ูุน ุชุญุฏูุฏ ุงูุญุฏูุฏ ุงูุฃูููุฉ ูุงูุดุจููุฉ.

**ุงููุทุงู:** ูุฑูุฒ ูุฐุง ุงููุฎุทุท ุนูู **ุทุจูููุฌูุง ุงููุดุฑ** ูุชุฏูู ุงูุจูุงูุงุช ุจูู ุงูุจูุฆุงุช. ูุฌูุจ ุนูู:
- ููู ุชููุดุฑ ุงูุฎุฏูุงุช ูู ูู ุจูุฆุฉุ
- ูุง ูู ุงูุญุฏูุฏ ุงูุฃูููุฉ ูุงูุดุจููุฉุ
- ููู ูุชู ุชุฏูู ุงูุจูุงูุงุช ูุงููุฑุงูุจุฉุ

**ุงูุฌูููุฑ ุงููุณุชูุฏู:**
- ๐๏ธ **ูููุฏุณู DevOps/SRE** โ ุชุฎุทูุท ุงููุดุฑ ูุงูุชูุณุน ูุงููุฑุงูุจุฉ
- ๐ **ูููุฏุณู ุงูุฃูุงู** โ ุชูููู ุงูุญุฏูุฏ ุงูุฃูููุฉ ูุงููุตูู
- ๐จโ๐ผ **ุงูุฅุฏุงุฑุฉ ุงูุชูููุฉ** โ ููู ุงูุจููุฉ ุงูุชุญุชูุฉ ูุงูุชูุงููู
- ๐ **ุงููุฑุงุฌุนูู** โ ุชูููู ุงูุงูุชุซุงู ูุงูุญูุงูุฉ

---

## ๐๏ธ ุจููุฉ ุงููุฎุทุท

### ููู ุงููุตุฏุฑ
- **ุงููููุน:** [`kaleem-deployment.mmd`](./kaleem-deployment.mmd)
- **ุงูุชูุณูู:** ูุฎุทุท Mermaid (TD - ูู ุฃุนูู ูุฃุณูู)
- **ุงูุชูููุฏ:** ูุชู ุชุตููุฑู ุชููุงุฆูุงู ุนุจุฑ CI/CD

### ุงูุชูุธูู ุงูุจุตุฑู

ูุชู ุชูุธูู ุงููุฎุทุท ูู ุทุจูุงุช ููุทููุฉ:

1. **๐ญ Production Environment** โ ุงูุจูุฆุฉ ุงูุฅูุชุงุฌูุฉ ูุงููุฉ
2. **๐งช Staging Environment** โ ุจูุฆุฉ ุงูุงุฎุชุจุงุฑ ูุจู ุงูุฅูุชุงุฌ
3. **๐ป Development Environment** โ ุจูุฆุฉ ุงูุชุทููุฑ ุงููุญูู
4. **๐ External Systems** โ ุงูุฃูุธูุฉ ุงูุฎุงุฑุฌูุฉ
5. **๐๏ธ Infrastructure** โ ุงูุจููุฉ ุงูุชุญุชูุฉ ุงูุฃุณุงุณูุฉ

---

## ๐ญ ุจูุฆุฉ ุงูุฅูุชุงุฌ (Production)

### ๐ ุทุจูุฉ DMZ / Edge
**ูุญูุท ุงูุดุจูุฉ ููุชุนุงูู ูุน ุญุฑูุฉ ุงููุฑูุฑ ุงูุฎุงุฑุฌูุฉ:**

| ุงููููู | ุงูุบุฑุถ | ุงูุชูููุฉ | ุงูุฃูุงู |
|---------|--------|---------|--------|
| **Nginx Load Balancer** | ุชูุฒูุน ุงูุญูู ูุฅููุงุก TLS | Nginx | SSL/TLSุ WAF |
| **Nginx Reverse Proxy** | ุชูุฌูู ุงูุทูุจุงุช | Nginx | Request Routing |
| **WhatsApp Evolution API** | ุจูุงุจุฉ WhatsApp ูุญููุฉ | Node.js | API Gateway |

### โ๏ธ ุฎุฏูุงุช ุงูุชุทุจูู ุงูุฃุณุงุณู
**ููุทู ุงูุนูู ูุงูุฎุฏูุงุช ุงูุฑุฆูุณูุฉ:**

#### ๐ฅ๏ธ ุฎุฏูุงุช ุงููุงุฌูุฉ ุงูุฃูุงููุฉ
- **Merchant Dashboard** โ ููุญุฉ ุชุญูู ุงูุชุงุฌุฑ (React/Vite)
- **Webchat Widget** โ ูุงุฌูุฉ ุงูุฏุฑุฏุดุฉ ุงููุฏูุฌุฉ

#### ๐ง ุฎุฏูุงุช ุงูุฎูููุฉ
- **API Server** โ ุฎุงุฏู API ุงูุฑุฆูุณู (NestJS)
- **Background Workers** โ ุงูุนุงูููู ูู ุงูุฎูููุฉ ููููุงู ุบูุฑ ุงููุชุฒุงููุฉ
- **n8n Workflow Engine** โ ูุญุฑู ุฃุชูุชุฉ ุงูุนูููุงุช ุงูุชุฌุงุฑูุฉ
- **Embedding Service** โ ุฎุฏูุฉ ุงูุชุถููู (Python/FastAPI)
- **Extractor Service** โ ุฎุฏูุฉ ุงุณุชุฎุฑุงุฌ ุงููุณุชูุฏุงุช (Python)

### ๐พ ุทุจูุฉ ุงูุซุจุงุช ุงูุจูุงูู
**ููุงุนุฏ ุงูุจูุงูุงุช ูุงูุชุฎุฒูู:**

| ูุงุนุฏุฉ ุงูุจูุงูุงุช | ุงูุบุฑุถ | ุงูุชูุฑุงุฑ | ุงูุฃุฏุงุก |
|----------------|--------|---------|--------|
| **MongoDB Cluster** | ุงููุฎุฒู ุงูุฑุฆูุณู | Replica Set (3 ุนูุฏ) | ุนุงูู |
| **Redis Cluster** | ุงูุชุฎุฒูู ุงููุคูุช ูุงูุฌูุณุงุช | Cluster Mode (6 ุนูุฏ) | ูุงุฆู |
| **Qdrant Cluster** | ุงูุจุญุซ ุงูุฏูุงูู | Sharded (3 ุนูุฏ) | ุนุงูู |
| **MinIO Cluster** | ุงูุชุฎุฒูู ุงูููุถุนู | Distributed (4 ุนูุฏ) | ุนุงูู |
| **RabbitMQ Cluster** | ูุณูุท ุงูุฑุณุงุฆู | High Availability | ุนุงูู |

### ๐ ูุฌููุนุฉ ุงููุฑุงูุจุฉ ูุงูุชุชุจุน
**ุฃุฏูุงุช ุงููุฑุงูุจุฉ ูุชุชุจุน ุงูุฃุฏุงุก:**

#### ๐ ุฌูุน ุงูููุงููุณ
- **Prometheus Server** โ ุฌูุน ุงูููุงููุณ (Retention: 15 ููู)
- **Alertmanager** โ ุฅุฏุงุฑุฉ ุงูุชูุจููุงุช ูุชูุฌูููุง

#### ๐ ุงูุชุตูุฑ ูุงูุชูุจูู
- **Grafana** โ ููุญุงุช ุงููุฑุงูุจุฉ ูุงูุชูุจูู

#### ๐ ุฎุท ุฃูุงุจูุจ ุงูุณุฌูุงุช
- **Loki** โ ุชุฌููุน ุงูุณุฌูุงุช ุงููุฑูุฒู
- **Promtail** โ ุดุญู ุงูุณุฌูุงุช ูู ุงูุญุงููุงุช

#### ๐ ุงูุชุชุจุน ุงูููุฒุน
- **Tempo** โ ุชุฎุฒูู ุขุซุงุฑ ุงูุชุชุจุน
- **OpenTelemetry Collector** โ ุฌูุน ุขุซุงุฑ ุงูุชุชุจุน

#### ๐ฅ๏ธ ูุฑุงูุจุฉ ุงููุธุงู
- **cAdvisor** โ ููุงููุณ ุงูุญุงููุงุช
- **Node Exporter** โ ููุงููุณ ุงููุธุงู
- **Redis Exporter** โ ููุงููุณ Redis
- **MongoDB Exporter** โ ููุงููุณ MongoDB

#### ๐จ ุชุชุจุน ุงูุฃุฎุทุงุก
- **Glitchtip** โ ูุฑุงูุจุฉ ุงูุฃุฎุทุงุก ูAPM
- **Postgres** โ ูุงุนุฏุฉ ุจูุงูุงุช Glitchtip

---

## ๐งช ุจูุฆุฉ ุงูุงุฎุชุจุงุฑ (Staging)

### ๐ง ุฎุฏูุงุช ุงูุงุฎุชุจุงุฑ
- **Staging API** โ ุฎุงุฏู API ููุงุฎุชุจุงุฑ (Port: 3001)
- **Staging Workers** โ ุนูุงู ุงูุฎูููุฉ ููุงุฎุชุจุงุฑ
- **Staging n8n** โ ูุญุฑู ุณูุฑ ุงูุนูู ููุงุฎุชุจุงุฑ (Port: 5679)

### ๐พ ุจูุงูุงุช ุงูุงุฎุชุจุงุฑ
- **ููุงุนุฏ ุจูุงูุงุช ูุดุชุฑูุฉ** โ MongoDBุ Redisุ Qdrant ูุน ูุฌููุนุงุช ูุนุฒููุฉ

---

## ๐ป ุจูุฆุฉ ุงูุชุทููุฑ (Development)

### ๐ง ุฎุฏูุงุช ุงูุชุทููุฑ
- **Dev API** โ ุฎุงุฏู API ูุญูู (Port: 3000ุ Hot Reload)
- **Dev n8n** โ ูุญุฑู ุณูุฑ ุงูุนูู ูุญูู (Port: 5678ุ Debug Mode)

### ๐๏ธ ุฃุฏูุงุช ุงูุชุทููุฑ
- **mongo-express** โ ูุงุฌูุฉ ุฅุฏุงุฑุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช (Port: 8081)
- **redis-commander** โ ูุงุฌูุฉ ุฅุฏุงุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช (Port: 8082)

---

## ๐ ุงูุฃูุธูุฉ ุงูุฎุงุฑุฌูุฉ

### ๐ค ุฎุฏูุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู
- **Google Gemini API** โ ููุงุฐุฌ ุงููุบุฉ ูุงูุชุถููู
- **OpenAI API** โ ููุงุฐุฌ GPT ุงูุจุฏููุฉ

### ๐ฑ ููุตุงุช ุงูุชูุงุตู
- **Telegram Bot API** โ ููุตุฉ ุงููุฑุงุณูุฉ
- **WhatsApp Cloud API** โ ุฑุณุงุฆู ุงูุฃุนูุงู
- **Instagram API** โ ุงูุชุฌุงุฑุฉ ุงูุงุฌุชูุงุนูุฉ
- **Facebook Messenger** โ ุงูุฑุณุงุฆู ุงููุจุงุดุฑุฉ

### ๐ ููุตุงุช ุงูุชุฌุงุฑุฉ ุงูุฅููุชุฑูููุฉ
- **Salla API** โ ููุตุฉ ุงูุชุฌุงุฑุฉ ุงูุณุนูุฏูุฉ
- **Zid API** โ ููุตุฉ ุงูุดุฑู ุงูุฃูุณุท
- **Shopify API** โ ููุตุฉ ุงูุชุฌุงุฑุฉ ุงูุนุงูููุฉ
- **WooCommerce API** โ ูุชุงุฌุฑ ููุฑุฏุจุฑูุณ

---

## ๐๏ธ ุงูุจููุฉ ุงูุชุญุชูุฉ ูุงูุดุจูุฉ

### ๐ ุงูุฃูุงู ูุงููุตูู
- **Firewall / WAF** โ ุญูุงูุฉ ูู DDoS ูุชุญุฏูุฏ ุงููุนุฏู
- **VPN Gateway** โ ุงููุตูู ุงูุขูู ูููุงุฆู IP ุงููุณููุญุฉ
- **Secrets Manager** โ ุฅุฏุงุฑุฉ ุงูุฃุณุฑุงุฑ ููุชุบูุฑุงุช ุงูุจูุฆุฉ

### โ๏ธ ููุงุฒูุฉ ุงูุญูู
- **Global Load Balancer** โ ุชูุฌูู ุฌุบุฑุงูู ูุชูุงูู CDN

---

## ๐ ุชุฏูู ุงูุจูุงูุงุช ูุงูุนูููุงุช

### ูุณุงุฑ ุญุฑูุฉ ุงููุฑูุฑ ูู ุงูุฅูุชุงุฌ:
```
External Users โ Load Balancer โ Reverse Proxy โ API Server
    โ
Background Workers โ RabbitMQ โ Job Queue โ API Server
    โ
MongoDB / Redis / Qdrant / MinIO โ Data Operations
    โ
Prometheus / Loki / Tempo โ Observability Data
```

### ูุณุงุฑ ุงููุฑุงูุจุฉ:
```
All Services โ Metrics โ Prometheus โ Grafana
    โ
Logs โ Promtail โ Loki โ Grafana
    โ
Traces โ OTel Collector โ Tempo โ Grafana
```

### ุญุฏูุฏ ุงูุฃูุงู:
```
Internet โ Firewall โ Load Balancer โ Core Services
    โ
VPN Gateway โ Secure Access โ Development Environment
    โ
Secrets Manager โ Environment Variables โ All Services
```

---

## ๐ ูุตูููุฉ ุงูุชูุณุน ูุงูุฃุฏุงุก

| ุงููููู | ููุท ุงูุชูุณุน | ุงูุฃุฏุงุก ุงููุณุชูุฏู | ุญุฏูุฏ ุงูููุงุฑุฏ |
|---------|-------------|------------------|---------------|
| **API Server** | ุฃููู (Load Balancer) | <100ms P95 | CPU: 2-4 cores |
| **Background Workers** | ุฃููู (Queue-based) | <1s processing | CPU: 1-2 cores |
| **MongoDB** | ูุฑุงุกุฉ replicas | <50ms queries | RAM: 8-16GB |
| **Redis** | Cluster mode | <1ms operations | RAM: 4-8GB |
| **Qdrant** | Sharding | <200ms search | RAM: 8-16GB |
| **MinIO** | Distributed | <500ms upload | Storage: 1-10TB |

---

## ๐ ุงุณุชุฑุงุชูุฌูุฉ ุงููุดุฑ ูุงูุฅุตุฏุงุฑ

### ูููุฐุฌ ุงููุดุฑ
- **Blue-Green Deployment** โ ููุฅุตุฏุงุฑุงุช ุงููุจูุฑุฉ
- **Rolling Updates** โ ููุชุญุฏูุซุงุช ุงูุชุฏุฑูุฌูุฉ
- **Canary Releases** โ ูุงุฎุชุจุงุฑ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### ุฅุฏุงุฑุฉ ุงูุฅุตุฏุงุฑุงุช
- **Semantic Versioning** โ ูุธุงู ุชุฑููู ุงูุฅุตุฏุงุฑุงุช
- **Image Tagging** โ ุฑุจุท ุงูุฅุตุฏุงุฑุงุช ุจุงูุตูุฑ
- **Rollback Strategy** โ ุงูุนูุฏุฉ ููุฅุตุฏุงุฑ ุงูุณุงุจู

### ูุฌุฑุฉ ููุงุนุฏ ุงูุจูุงูุงุช
- **Forward-only Migrations** โ ุนุฏู ูุฌูุฏ ุชุฑุงุฌุน
- **Backfill Strategy** โ ููุก ุงูุจูุงูุงุช ุงูุชุงุฑูุฎูุฉ
- **Backup Testing** โ ุงุฎุชุจุงุฑ ุงููุณุฎ ุงูุงุญุชูุงุทู

---

## ๐ ุงูุญุฏูุฏ ุงูุฃูููุฉ

### ุทุจูุงุช ุงูุญูุงูุฉ
1. **Internet โ Firewall** โ ุญูุงูุฉ ูู ุงููุฌูุงุช ุงูุฎุงุฑุฌูุฉ
2. **DMZ โ Core Services** โ ุนุฒู ููุทูุฉ ุงูุดุจูุฉ ุงููุนุฒููุฉ
3. **Core โ Data Layer** โ ูุจุฏุฃ ุงูุฃูู ุตูุงุญูุฉ
4. **Application โ External APIs** โ ุชุดููุฑ ุงูุงุชุตุงูุงุช

### ุณูุงุณุงุช ุงููุตูู
- **Network Segmentation** โ ุชูุณูู ุงูุดุจูุฉ
- **Service Accounts** โ ุญุณุงุจุงุช ุฎุฏูุฉ ูุญุฏูุฏุฉ
- **API Rate Limiting** โ ุชุญุฏูุฏ ุงููุนุฏู ุญุณุจ ุงููุณุชุฃุฌุฑ
- **Audit Logging** โ ุชุณุฌูู ุฌููุน ุงูุนูููุงุช ุงูุญุณุงุณุฉ

---

## ๐ ุงูุงุนุชุจุงุฑุงุช ุงูุชุดุบูููุฉ

### ูุฑุงูุจุฉ ุงูุฃุฏุงุก
- **SLO Targets** โ ุฃูุฏุงู ูุณุชูู ุงูุฎุฏูุฉ
- **Error Budgets** โ ููุฒุงููุฉ ุงูุฃุฎุทุงุก ุงููุณููุญุฉ
- **Capacity Planning** โ ุชุฎุทูุท ุงูุณุนุฉ ุงููุณุชูุจููุฉ

### ุฅุฏุงุฑุฉ ุงูุชูุงููู
- **Resource Optimization** โ ุชุญุณูู ุงุณุชุฎุฏุงู ุงูููุงุฑุฏ
- **Auto-scaling** โ ุงูุชูุณุน ุงูุชููุงุฆู
- **Reserved Instances** โ ุญุฌุฒ ุงูููุงุฑุฏ ูุณุจูุงู

### ุงููุณุฎ ุงูุงุญุชูุงุทู ูุงูุงุณุชุฑุฏุงุฏ
- **Backup Strategy** โ ุงุณุชุฑุงุชูุฌูุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู
- **RTO/RPO** โ ุฃูุฏุงู ููุช ุงูุงุณุชุฑุฏุงุฏ/ุงููุฏู ุงููุญุฏุฏ
- **Disaster Recovery** โ ุฎุทุท ุงูุงุณุชุฑุฏุงุฏ ูู ุงูููุงุฑุซ

---

## ๐ง ุงูุชุทููุฑ ูุงูุงุฎุชุจุงุฑ

### ุจูุฆุฉ ุงูุชุทููุฑ ุงููุญูู
- **Docker Compose** โ ุชุดุบูู ูุงูู ููุชุทููุฑ
- **Hot Reload** โ ุฅุนุงุฏุฉ ุชุญููู ุชููุงุฆู
- **Debug Configuration** โ ุฅุนุฏุงุฏุงุช ูุญุณูุฉ ููุชุตุญูุญ

### ุงุฎุชุจุงุฑ ุงูุชูุงูู
- **Environment Parity** โ ุชุทุงุจู ุงูุจูุฆุงุช
- **Data Seeding** โ ุจูุงูุงุช ุงุฎุชุจุงุฑ ูุงูุนูุฉ
- **Service Mocking** โ ูุญุงูุงุฉ ุงูุฎุฏูุงุช ุงูุฎุงุฑุฌูุฉ

### ุงุฎุชุจุงุฑ ุงูุฃุฏุงุก
- **Load Testing** โ ุงุฎุชุจุงุฑ ุชุญุช ุงูุญูู
- **Stress Testing** โ ุงุฎุชุจุงุฑ ุชุญุช ุงูุถุบุท
- **Chaos Engineering** โ ุงุฎุชุจุงุฑ ุงูุชุญูู

---

## ๐ Related Documentation

### Predecessors
- **[API Components](./api-components.md)** โ ููููุงุช API ุงูุฏุงุฎููุฉ
- **[Container Diagram](./container.md)** โ ุญุงููุงุช ุงููุธุงู ูุนูู ุนูุงูุงุชูุง
- **[Tech Stack Rationale](../4-Tech%20Stack%20Rationale/tech-stack-rationale.md)** โ ุชุจุฑูุฑ ุงุฎุชูุงุฑ ุงูุชูููุงุช

### Successors
- **[Runbooks](../../../2-%D9%88%D8%AB%D8%A7%D8%A6%D9%82%20%D8%A7%D9%84%D8%AA%D8%B4%D8%BA%D9%8A%D9%84%20%28Ops%20&%20DevOps%29/)** โ ุฅุฌุฑุงุกุงุช ุงูุชุดุบูู

### External References
- **[Kubernetes Documentation](https://kubernetes.io/)** โ ุชูุณูู ุงูุญุงููุงุช
- **[Docker Documentation](https://docs.docker.com/)** โ ุงูุญุงููุงุช
- **[Nginx Documentation](https://nginx.org/)** โ ุฎุงุฏู ุงูููุจ
- **[Prometheus Documentation](https://prometheus.io/)** โ ุงููุฑุงูุจุฉ

---

## ๐ Maintenance & Updates

### Update Triggers
- ุฅุถุงูุฉ ุฎุฏูุฉ ุฌุฏูุฏุฉ ุฃู ุชุบููุฑ ูู ุงูุจููุฉ
- ุชุญุฏูุซ ูุชุทูุจุงุช ุงูุฃุฏุงุก ุฃู ุงูุฃูุงู
- ุชุบููุฑุงุช ูู ุงูุจููุฉ ุงูุชุญุชูุฉ
- ุชุญุณููุงุช ูู ุงููุฑุงูุจุฉ ุฃู ุงููุฑููุฉ

### Review Cycle
- **ุฃุณุจูุนู:** ูุญุต ุงูุฏูุฉ ุงูุชุดุบูููุฉ
- **ุดูุฑู:** ูุฑุงุฌุนุฉ ุงูุฃุฏุงุก ูุงูุชูุงููู
- **ุฑุจุน ุณููู:** ุชูููู ุงูุฃูุงู ูุงูุญูุงูุฉ
- **ุณููู:** ูุฑุงุฌุนุฉ ุงูุนูุงุฑุฉ ูุงูุชุญุฏูุซ

### Version History
- **v1.0 (2025-09-27):** ูุฎุทุท ูุดุฑ C4 ูุญุชุฑู ูุน ุชูุงุตูู ุดุงููุฉ
- **v0.1 (2025-09-27):** ูููู ุฃุณุงุณู ููุจูุฆุงุช ูุงูุฎุฏูุงุช

---

> **ุงูุฎุทูุงุช ุงูุชุงููุฉ:** ุจุนุฏ ููู ุทุจูููุฌูุง ุงููุดุฑุ ุงูุชูู ุฅูู **[Runbooks](../../../2-%D9%88%D8%AB%D8%A7%D8%A6%D9%82%20%D8%A7%D9%84%D8%AA%D8%B4%D8%BA%D9%8A%D9%84%20%28Ops%20&%20DevOps%29/)** ููุฅุฌุฑุงุกุงุช ุงูุชุดุบูููุฉุ ุฃู **[Tech Stack Rationale](../4-Tech%20Stack%20Rationale/tech-stack-rationale.md)** ูุชุจุฑูุฑ ุงุฎุชูุงุฑ ุงูุชูููุงุช.
