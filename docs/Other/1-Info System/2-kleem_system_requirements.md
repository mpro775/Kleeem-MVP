# Kaleem — وثيقة متطلبات النظام (System Requirements Specification)

**الإصدار:** 1.1  
**التاريخ:** 17 سبتمبر 2025  
**المالك:** فريق Kaleem (المنتج والهندسة والجودة)

---

## 1) المقدّمة

### 1.1 الغرض من الوثيقة
تحديد المتطلبات الوظيفية وغير الوظيفية لمنصة **Kaleem** بما يضمن اتساق التنفيذ مع رؤية المشروع (الإصدار 1.1) واحتياجات العمل.

### 1.2 نطاق النظام
منصة SaaS متعددة المستأجرين (Multi-tenant) تقدم خدمة دردشة ذكية للتجار عبر قنوات متعددة (واتساب، تيليغرام، ودجت ويب، ولاحقًا إنستغرام وفيسبوك)، مدعومة ببحث دلالي وقاعدة معرفة ومتجر مصغّر.

### 1.3 المراجع
- وثيقة رؤية المشروع (الإصدار 1.1).  
- وثائق التصميم المعماري لمنصة Kleem.  
- وثائق الأمن والمراقبة.  
- ملفات الـ Workflow الخاصة بالتكاملات والذكاء.  

### 1.4 التعاريف والاختصارات
**ASR**: تحويل الكلام إلى نص.  
**OCR**: استخراج النص من الصور.  
**RAG**: استرجاع قبل التوليد.  
**Intent**: النيّة الدلالية للسؤال.  
**Order Intent**: نية الشراء.  
**Omnichannel**: إدارة القنوات من لوحة واحدة.

---

## 2) الوصف العام

### 2.1 منظور المنتج
بنية Modular Monolith (NestJS) مع خدمات متخصصة (Embedding/Qdrant/MinIO) وتكاملات مع متاجر وقنوات خارجية.

### 2.2 فئات المستخدمين
- **مالك المتجر (Admin)**  
- **مشغّل الدعم (Agent)**  
- **محلل/مدير نمو (Analyst)**  
- **العميل النهائي (Shopper)**

### 2.3 بيئة التشغيل
- VPS + Docker Compose (إطلاق أولي).  
- قابلية الترحيل إلى Kubernetes مستقبلاً.  
- واجهات React/Vite (لوحة التاجر + المتجر المصغّر).  
- قواعد بيانات: MongoDB, Redis, Qdrant.  
- التخزين: MinIO.  

### 2.4 القيود
- دعم العربية (فصحى ولهجات).  
- زمن استجابة ≤ 5 ث.  
- SLA ≥ 99.9%.  

### 2.5 الافتراضات والاعتمادات
- استقرار APIs (Meta Cloud API, Telegram Bot API, Salla/Zid APIs).  
- توفر مراقبة (Prometheus/Grafana) واسترداد نسخ (Backups).  

---

## 3) المتطلبات الوظيفية (Functional Requirements)

### 3.1 المصادقة والتفويض (AUTH)
- **AUTH-001**: تسجيل دخول بالبريد/كلمة مرور، جلسات JWT.  
- **AUTH-002**: أدوار (Admin/Agent/Analyst).  
- **AUTH-003**: MFA اختياري.  
- **AUTH-004**: (V1.1+) دعم SSO (Google/Microsoft).  

### 3.2 إدارة القنوات (CHAN)
- **CHAN-001**: دعم واتساب (Cloud API الرسمي) + تيليغرام + ودجت ويب في V1.  
- **CHAN-002**: Inbox موحد مع فلاتر (قناة/حالة/عميل).  
- **CHAN-003**: (V1.2) دعم إنستغرام/فيسبوك.  

### 3.3 الذكاء الاصطناعي والنيّة (AI/INTENT)
- **AI-001**: Intent-first Routing.  
- **AI-002**: RAG إلزامي قبل الرد على المنتجات.  
- **AI-003**: دعم النبرة المخصصة للتاجر.  
- **AI-004**: تسجيل Missing Responses للتدريب.  

### 3.4 البحث الدلالي على المنتجات (PROD)
- **PROD-001**: استعلام دلالي (Qdrant) يعيد اسم/سعر/رابط.  
- **PROD-002**: اقتراح بدائل عند عدم التوفر.  
- **PROD-003**: دعم أسئلة مثل "وش عندكم؟" لاستخراج الأقسام.  

### 3.5 قاعدة المعرفة (KB)
- **KB-001**: CRUD للمقالات والسياسات.  
- **KB-002**: استيراد Word/Excel/PDF وروابط.  
- **KB-003**: بحث دلالي داخل المعرفة.  
- **KB-004**: Workflow مراجعة قبل النشر.  

### 3.6 المتجر المصغّر (STF)
- **STF-001**: كتالوج أساسي (قائمة/تفاصيل).  
- **STF-002**: زر "الدردشة للشراء" يفتح القناة مع تمرير سياق المنتج.  
- **STF-003**: جمع نوايا الشراء وربطها بالعملاء.  

### 3.7 الودجت والويب شات (WIDG)
- **WIDG-001**: تخصيص المظهر (ألوان/شعار/لغة).  
- **WIDG-002**: دعم قواعد الرد التلقائي (ترحيب/خارج الدوام).  

### 3.8 الطلبات والتكاملات (ORD/INTG)
- **ORD-001**: استعلام حالة الطلب من المتاجر المتكاملة (Salla/Zid/Shopify).  
- **INTG-001**: نشر ودجت عبر سكربت تضمين.  

### 3.9 فهم الوسائط (MEDIA)
- **MEDIA-001**: تحويل صوت → نص (ASR).  
- **MEDIA-002**: استخراج نصوص من الصور (OCR).  
- **MEDIA-003**: قراءة محتوى Word/Excel/PDF.  
- **MEDIA-004**: (V2) الرد الصوتي.  

### 3.10 التحليلات (ANALYTICS)
- **AN-001**: جمع أحداث (سؤال/رد/زمن/قناة/تقييم).  
- **AN-002**: KPIs: رضا ≥90%، حل ذاتي ≥85%.  
- **AN-003**: تقارير يومية/شهرية وتصدير CSV/PDF.  

---

## 4) المتطلبات غير الوظيفية (Non-Functional)

### 4.1 الأداء
- واجهة المستخدم ≤ 2 ث.  
- ردود AI ≤ 5 ث.  
- دعم 10k رسالة/دقيقة.  

### 4.2 التوفرية
- SLA ≥ 99.9%.  
- RTO ≤ 4 ساعات، RPO ≤ 1 ساعة.  
- نسخ احتياطي يومي/أسبوعي.  

### 4.3 الأمان
- HTTPS فقط، HSTS، CSP.  
- JWT + RBAC.  
- Secret Management (Vault/Env).  
- Audit Logs للعمليات الحساسة.  

### 4.4 القابلية للتوسع
- توسع أفقي.  
- Redis Cache (L1/L2).  
- دعم Sharding/Replica في MongoDB.  

### 4.5 القابلية للصيانة
- تغطية اختبارات ≥70% V1 (خطة للوصول 85%).  
- CI/CD مع Lint/Test/Security.  
- وثائق Runbooks للطوارئ.  

### 4.6 المراقبة
- Prometheus, Grafana, Loki, Alertmanager.  
- تتبع موزع (OpenTelemetry/Tempo).  

### 4.7 الخصوصية والامتثال
- GDPR (حق النسيان، تصدير البيانات).  
- إخفاء PII في السجلات.  

### 4.8 التدويل والوصولية (i18n/a11y)
- دعم ar/en.  
- RTL/LTR.  
- WCAG 2.1.  

---

## 5) البيانات (Data Requirements)
- كيانات: Merchant، Channel، Customer، Conversation، Message، Product، KnowledgeDoc، OrderIntent، Rating.  
- سياسة احتفاظ: 12 شهرًا افتراضيًا (قابلة للتخصيص لكل تاجر).  
- فهارس مركبة (merchantId, createdAt, status).  

---

## 6) خارطة الطريق (Roadmap)
- **V1 (Q4 2025)**: واتساب + تيليغرام + ودجت، متجر مصغّر، قاعدة معرفة، بحث دلالي، OCR/ASR، Inbox موحد.  
- **V1.1 (Q1 2026)**: الرد التلقائي، لوحات نوايا الشراء، تحسين التحليلات، Workflow مراجعة.  
- **V1.2 (Q2 2026)**: إنستغرام/فيسبوك، تخصيص مظهر المتجر المصغّر، إدارة متقدمة للعملاء.  
- **V2 (2026–2027)**: شحن ودفع محلي، ردود صوتية، Store Agent شبه ذاتي.  

---

## 7) التحقق والقبول (Verification & Acceptance)
- اختبارات تحميل (≥10k رسالة/دقيقة).  
- اختبارات أمن (OWASP ASVS + اختراق).  
- E2E عبر Playwright.  
- UAT مع 10 تجار حقيقيين قبل الإطلاق.  

