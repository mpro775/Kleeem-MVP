# ูุฎุทุท C4 - ุงูููููุงุช ุงูุฏุงุฎููุฉ (Component Diagram) - API ุงูุฑุฆูุณู

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุฐุง ุงููุฎุทุท ููุถุญ ุงูููููุงุช ุงูุฏุงุฎููุฉ ูู API ุงูุฑุฆูุณู ูู ููุตุฉ Kaleem ูุงูุชูุงุนู ุจูููุง.

---

## ๐ฏ ุงููุณุชุฎุฏููู ูุงูุฃูุธูุฉ ุงูุฎุงุฑุฌูุฉ

### ุงููุณุชุฎุฏููู

- **ุงูุชุงุฌุฑ**: ูุฏูุฑ ูุชุฌุฑู ูุฅุนุฏุงุฏุงุชู
- **ุงูุนููู**: ูุชุญุฏุซ ูุน ูููู ููุดุชุฑู
- **ุงูุฃุฏูู ุงูุนุงู**: ูุดุฑู ุนูู ุงูููุตุฉ

### ุงูุฃูุธูุฉ ุงูุฎุงุฑุฌูุฉ

- **WhatsApp/Telegram**: ูููุงุช ุงูุชูุงุตู
- **Salla/Zid/Shopify**: ููุตุงุช ุงูุชุฌุงุฑุฉ ุงูุฅููุชุฑูููุฉ
- **Payment Gateway**: ุจูุงุจุฉ ุงูุฏูุน
- **LLM Provider**: ุฎุฏูุฉ ููุงุฐุฌ ุงููุบุฉ
- **Merchant Website**: ูููุน ุงูุชุงุฌุฑ

---

## ๐๏ธ ููููุงุช API ุงูุฑุฆูุณู

### 1. ุทุจูุฉ ุงูุชุญูู (Controllers)

#### ุฃ) ูุชุญูู Webhook ุงููููุงุช (ChannelWebhookController)

- **ุงููุธููุฉ**: ูุนุงูุฌุฉ Webhooks ูู ุงููููุงุช ุงููุฎุชููุฉ
- **ุงููุณุคูููุงุช**:
  - ุงุณุชูุจุงู ุงูุฑุณุงุฆู ูู WhatsApp/Telegram
  - ุงูุชุญูู ูู ุตุญุฉ ุงูุชูููุนุงุช
  - ุชูุฌูู ุงูุฑุณุงุฆู ูููุนุงูุฌุฉ
  - ุฅุฑุณุงู ุฑุฏูุฏ ุงูุชููุงุฆูุฉ

#### ุจ) ูุชุญูู ุงูููุจ ุดุงุช (WebChatController)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุฌูุณุงุช ุงูููุจ ุดุงุช ูุงูุงุชุตุงู ุงููุจุงุดุฑ
- **ุงููุณุคูููุงุช**:
  - ุฅูุดุงุก ูุฅุฏุงุฑุฉ ุงูุฌูุณุงุช
  - ูุนุงูุฌุฉ ุงูุฑุณุงุฆู ุงููุจุงุดุฑุฉ
  - ุฅุฏุงุฑุฉ ุงูุงุชุตุงู WebSocket
  - ุชูุณูู ุงูุฑุฏูุฏ

#### ุฌ) ูุชุญูู ุงููุญุงุฏุซุงุช (ConversationsController)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุงููุญุงุฏุซุงุช ูุงูุฑุณุงุฆู
- **ุงููุณุคูููุงุช**:
  - ุฅูุดุงุก ุงููุญุงุฏุซุงุช ุงูุฌุฏูุฏุฉ
  - ุญูุธ ูุงุณุชุฑุฌุงุน ุงูุฑุณุงุฆู
  - ุฅุฏุงุฑุฉ ุญุงูุฉ ุงููุญุงุฏุซุงุช
  - ุชุชุจุน ุชูุฏู ุงููุญุงุฏุซุงุช

#### ุฏ) ูุชุญูู ุงูุชุฏุฑูุจ (TrainingController)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุชูููู ูุชุฏุฑูุจ ุงูููุงุฐุฌ
- **ุงููุณุคูููุงุช**:
  - ุฌูุน ุจูุงูุงุช ุงูุชุฏุฑูุจ
  - ุชูููู ุฃุฏุงุก ุงูููุงุฐุฌ
  - ุฅุฏุงุฑุฉ ุฏูุฑุฉ ุงูุชุฏุฑูุจ
  - ุชุญููู ุงููุชุงุฆุฌ

#### ูู) ูุชุญูู ุงููุนุฑูุฉ (KnowledgeController)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุงููุซุงุฆู ูุงูFAQ ูุงูููุฑุณุฉ
- **ุงููุณุคูููุงุช**:
  - ุฅุฏุงุฑุฉ ูุงุนุฏุฉ ุงููุนุฑูุฉ
  - ููุฑุณุฉ ุงููุญุชูู
  - ุงูุจุญุซ ูู ุงููุนุฑูุฉ
  - ุชุญุฏูุซ ุงููุนูููุงุช

#### ู) ูุชุญูู ุงูููุชุฌุงุช (ProductsController)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุจุญุซ ูุชูุงุตูู ูููุฑุณุฉ ุงูููุชุฌุงุช
- **ุงููุณุคูููุงุช**:
  - ุฅุฏุงุฑุฉ ูุชุงููุฌ ุงูููุชุฌุงุช
  - ุงูุจุญุซ ูู ุงูููุชุฌุงุช
  - ุชุญุฏูุซ ูุนูููุงุช ุงูููุชุฌุงุช
  - ูุฒุงููุฉ ูุน ุงูููุตุงุช ุงูุฎุงุฑุฌูุฉ

#### ุฒ) ูุชุญูู ุงููุชุฌุฑ ุงููุตุบูุฑ (StorefrontController)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุณูุฉ ุงูุชุณูู ูุงูุทูุจุงุช ูุงููุฏููุนุงุช
- **ุงููุณุคูููุงุช**:
  - ุฅุฏุงุฑุฉ ุณูุฉ ุงูุชุณูู
  - ูุนุงูุฌุฉ ุงูุทูุจุงุช
  - ุชูุณูู ุงููุฏููุนุงุช
  - ุฅุฏุงุฑุฉ ุงููุฎุฒูู

#### ุญ) ูุชุญูู ุงููุฏููุนุงุช (PaymentsController)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุจูุงุจุฉ ุงูุฏูุน
- **ุงููุณุคูููุงุช**:
  - ูุนุงูุฌุฉ ุงููุฏููุนุงุช
  - ุงูุชุญูู ูู ุงููุนุงููุงุช
  - ุฅุฏุงุฑุฉ ุงูุงุณุชุฑุฏุงุฏุงุช
  - ุชุชุจุน ุงููุฏููุนุงุช

#### ุท) ูุชุญูู ุงูุชูุงููุงุช (IntegrationsController)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุชูุงูู Salla/Zid/Shopify ูุงููุตุงุฏูุฉ ูุงููุฒุงููุฉ
- **ุงููุณุคูููุงุช**:
  - ุฅุฏุงุฑุฉ ุงูุชูุงููุงุช ุงูุฎุงุฑุฌูุฉ
  - ูุฒุงููุฉ ุงูุจูุงูุงุช
  - ุฅุฏุงุฑุฉ ุงููุตุงุฏูุฉ
  - ุชูุณูู ุงูุนูููุงุช

#### ู) ูุชุญูู ุงูุฃุฏูู (AdminController)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ ูุงูุชูุงุฑูุฑ
- **ุงููุณุคูููุงุช**:
  - ุฅุฏุงุฑุฉ ุฅุนุฏุงุฏุงุช ุงููุธุงู
  - ุชูููุฏ ุงูุชูุงุฑูุฑ
  - ูุฑุงูุจุฉ ุงูุฃุฏุงุก
  - ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู

### 2. ุทุจูุฉ ุงูุฎุฏูุงุช (Services)

#### ุฃ) ุฎุฏูุฉ ุงููุญุงุฏุซุงุช (ConversationService)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ููุทู ุงููุญุงุฏุซุงุช
- **ุงููุณุคูููุงุช**:
  - ุชูุณูู ุชุฏูู ุงููุญุงุฏุซุงุช
  - ุฅุฏุงุฑุฉ ุญุงูุฉ ุงููุญุงุฏุซุงุช
  - ูุนุงูุฌุฉ ุงูุฑุณุงุฆู
  - ุชูุณูู ุงูุฑุฏูุฏ

#### ุจ) ุญุงุฑุณ ุณูุงุณุฉ ุงููุญุงุฏุซุงุช (ConversationPolicyGuard)

- **ุงููุธููุฉ**: ุชุทุจูู ุณูุงุณุงุช ุงููุญุงุฏุซุงุช
- **ุงููุณุคูููุงุช**:
  - ุงูุชุญูู ูู ุงูุตูุงุญูุงุช
  - ุชุทุจูู ุงูููุงุนุฏ
  - ูุฑุงูุจุฉ ุงูุณููู
  - ููุน ุงูุงูุชูุงูุงุช

#### ุฌ) ุฎุฏูุฉ ุงูุชุณููู (HandoffService)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุชุณููู ุงููุญุงุฏุซุงุช ููุจุดุฑ
- **ุงููุณุคูููุงุช**:
  - ุชุญุฏูุฏ ุงูุญุงุฌุฉ ููุชุณููู
  - ุชูุณูู ุงูุชุณููู
  - ุฅุฏุงุฑุฉ ุงูุงูุชุธุงุฑ
  - ุชุชุจุน ุงูุญุงูุฉ

#### ุฏ) ุนููู ููุณู ุงูุฐูุงุก ุงูุงุตุทูุงุนู (AIOrchestratorClient)

- **ุงููุธููุฉ**: ุงูุชูุงุตู ูุน ููุณู ุงูุฐูุงุก ุงูุงุตุทูุงุนู
- **ุงููุณุคูููุงุช**:
  - ุฅุฑุณุงู ุงูุทูุจุงุช
  - ุงุณุชูุจุงู ุงูุฑุฏูุฏ
  - ุฅุฏุงุฑุฉ ุงูุงุชุตุงู
  - ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

#### ูู) ุฎุฏูุฉ ุณุฌู ุงูุฃุฏูุงุช (ToolRegistryService)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุณุฌู ุงูุฃุฏูุงุช ุงููุชุงุญุฉ
- **ุงููุณุคูููุงุช**:
  - ุชุณุฌูู ุงูุฃุฏูุงุช
  - ุฅุฏุงุฑุฉ ุงูุชููุฑ
  - ุชูุณูู ุงูุงุณุชุฎุฏุงู
  - ูุฑุงูุจุฉ ุงูุฃุฏุงุก

#### ู) ุฎุฏูุฉ ุงููุนุฑูุฉ (KnowledgeService)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุงููุนุฑูุฉ ูุงูุจุญุซ
- **ุงููุณุคูููุงุช**:
  - ุงูุจุญุซ ูู ุงููุนุฑูุฉ
  - ุฅุฏุงุฑุฉ ุงููุญุชูู
  - ุชุญุฏูุซ ุงููุนูููุงุช
  - ุชุญุณูู ุงููุชุงุฆุฌ

#### ุฒ) ุฎุฏูุฉ ุจุญุซ ุงูููุชุฌุงุช (ProductSearchService)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุงูุจุญุซ ูู ุงูููุชุฌุงุช
- **ุงููุณุคูููุงุช**:
  - ุงูุจุญุซ ูู ุงูููุชุฌุงุช
  - ุชุตููุฉ ุงููุชุงุฆุฌ
  - ุชุฑุชูุจ ุงููุชุงุฆุฌ
  - ุชุญุณูู ุงูุจุญุซ

#### ุญ) ุฎุฏูุฉ ุงููุชุฌูุงุช (VectorService)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุงูุนูููุงุช ุงููุชุฌูุฉ
- **ุงููุณุคูููุงุช**:
  - ุงูุจุญุซ ูู ุงููุชุฌูุงุช
  - ุฅุฏุงุฑุฉ ุงูููุงุฑุณ
  - ุชุญุณูู ุงูุฃุฏุงุก
  - ุชูุณูู ุงูุนูููุงุช

#### ุท) ุนููู ุงูุชุถููู (EmbeddingClient)

- **ุงููุธููุฉ**: ุงูุชูุงุตู ูุน ุฎุฏูุฉ ุงูุชุถููู
- **ุงููุณุคูููุงุช**:
  - ุฅุฑุณุงู ุงููุตูุต
  - ุงุณุชูุจุงู ุงููุชุฌูุงุช
  - ุฅุฏุงุฑุฉ ุงูุงุชุตุงู
  - ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

#### ู) ุนููู ุงูุงุณุชุฎุฑุงุฌ (ExtractorClient)

- **ุงููุธููุฉ**: ุงูุชูุงุตู ูุน ุฎุฏูุฉ ุงูุงุณุชุฎุฑุงุฌ
- **ุงููุณุคูููุงุช**:
  - ุฅุฑุณุงู ุงูุทูุจุงุช
  - ุงุณุชูุจุงู ุงููุชุงุฆุฌ
  - ุฅุฏุงุฑุฉ ุงูุงุชุตุงู
  - ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

#### ู) ุฎุฏูุฉ ุงูุชูููู (FeedbackService)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุงูุชููููุงุช ูุงูููุงุญุธุงุช
- **ุงููุณุคูููุงุช**:
  - ุฌูุน ุงูุชููููุงุช
  - ุชุญููู ุงููุชุงุฆุฌ
  - ุฅุฏุงุฑุฉ ุงูุชุญุณููุงุช
  - ุชุชุจุน ุงูุชูุฏู

#### ู) ุฎุฏูุฉ ุงูุชุนูููุงุช (InstructionService)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุงูุชุนูููุงุช ูุงูุชูุฌููุงุช
- **ุงููุณุคูููุงุช**:
  - ุฅุฏุงุฑุฉ ุงูุชุนูููุงุช
  - ุชุทุจูู ุงูุชูุฌููุงุช
  - ุชุญุฏูุซ ุงูููุงุนุฏ
  - ูุฑุงูุจุฉ ุงูุงูุชุซุงู

#### ู) ุฎุฏูุฉ ุฅุนุงุฏุฉ ุงูุชุฑุชูุจ (RerankerService)

- **ุงููุธููุฉ**: ุฅุนุงุฏุฉ ุชุฑุชูุจ ุงููุชุงุฆุฌ
- **ุงููุณุคูููุงุช**:
  - ุชุญุณูู ุงูุชุฑุชูุจ
  - ุชุทุจูู ุงูุฎูุงุฑุฒููุงุช
  - ุชุญุณูู ุงูุฏูุฉ
  - ูุฑุงูุจุฉ ุงูุฃุฏุงุก

#### ู) ุฎุฏูุฉ ุงููุฏููุนุงุช (PaymentsService)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุนูููุงุช ุงูุฏูุน
- **ุงููุณุคูููุงุช**:
  - ูุนุงูุฌุฉ ุงููุฏููุนุงุช
  - ุฅุฏุงุฑุฉ ุงููุนุงููุงุช
  - ุชูุณูู ุงูุนูููุงุช
  - ูุฑุงูุจุฉ ุงูุฃูุงู

#### ุณ) ุฎุฏูุฉ ุงูุชูุงููุงุช (IntegrationsService)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุงูุชูุงููุงุช ุงูุฎุงุฑุฌูุฉ
- **ุงููุณุคูููุงุช**:
  - ุชูุณูู ุงูุชูุงููุงุช
  - ูุฒุงููุฉ ุงูุจูุงูุงุช
  - ุฅุฏุงุฑุฉ ุงูุงุชุตุงูุงุช
  - ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

#### ุน) ุฎุฏูุฉ ุงูุชุฎุฒูู ุงููุคูุช (CacheService)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช
- **ุงููุณุคูููุงุช**:
  - ุชุฎุฒูู ุงูุจูุงูุงุช ุงููุคูุชุฉ
  - ุฅุฏุงุฑุฉ ุงูุชูุงุก ุงูุตูุงุญูุฉ
  - ุชุญุณูู ุงูุฃุฏุงุก
  - ุชูุณูู ุงูุนูููุงุช

#### ุบ) ุญุงููุฉ ุงูุฃุญุฏุงุซ (EventBus)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุงูุฃุญุฏุงุซ ูุงูุฑุณุงุฆู
- **ุงููุณุคูููุงุช**:
  - ูุดุฑ ุงูุฃุญุฏุงุซ
  - ุงุณุชููุงู ุงูุฑุณุงุฆู
  - ุชูุณูู ุงูุนูููุงุช
  - ุฅุฏุงุฑุฉ ุงูุชุฏูู

#### ู) ูุณุฌู ุงูุชุฏููู (AuditLogger)

- **ุงููุธููุฉ**: ุชุณุฌูู ุนูููุงุช ุงูุชุฏููู
- **ุงููุณุคูููุงุช**:
  - ุชุณุฌูู ุงูุนูููุงุช
  - ุชุชุจุน ุงูุชุบููุฑุงุช
  - ุฅุฏุงุฑุฉ ุงูุณุฌูุงุช
  - ูุฑุงูุจุฉ ุงูุฃูุงู

#### ุต) ูุญูู ุชูููุน Webhook (WebhookSignatureVerifier)

- **ุงููุธููุฉ**: ุงูุชุญูู ูู ุชูููุนุงุช Webhook
- **ุงููุณุคูููุงุช**:
  - ุงูุชุญูู ูู ุงูุชูููุนุงุช
  - ุถูุงู ุงูุฃูุงู
  - ููุน ุงูุชุฒููุฑ
  - ุชูุณูู ุงูุนูููุงุช

#### ู) ูุชุฌุฑ ุนุฏู ุงูุชูุฑุงุฑ (IdempotencyStore)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุนุฏู ุงูุชูุฑุงุฑ
- **ุงููุณุคูููุงุช**:
  - ููุน ุงูุชูุฑุงุฑ
  - ุฅุฏุงุฑุฉ ุงูููุงุชูุญ
  - ุชุญุณูู ุงูุฃุฏุงุก
  - ุถูุงู ุงูุงุชุณุงู

### 3. ุทุจูุฉ ุงููุณุชูุฏุนุงุช (Repositories)

#### ุฃ) ูุณุชูุฏุน ุงููุญุงุฏุซุงุช (ConversationRepo)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุจูุงูุงุช ุงููุญุงุฏุซุงุช
- **ุงููุณุคูููุงุช**:
  - ุญูุธ ุงููุญุงุฏุซุงุช
  - ุงุณุชุฑุฌุงุน ุงูุจูุงูุงุช
  - ุชุญุฏูุซ ุงููุนูููุงุช
  - ุญุฐู ุงูุณุฌูุงุช

#### ุจ) ูุณุชูุฏุน ุงูุฑุณุงุฆู (MessageRepo)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุจูุงูุงุช ุงูุฑุณุงุฆู
- **ุงููุณุคูููุงุช**:
  - ุญูุธ ุงูุฑุณุงุฆู
  - ุงุณุชุฑุฌุงุน ุงูุฑุณุงุฆู
  - ุชุญุฏูุซ ุงูุญุงูุฉ
  - ุฅุฏุงุฑุฉ ุงูููุฑุณุฉ

#### ุฌ) ูุณุชูุฏุน ุบูุฑ ุงููุฌุงุจ (UnansweredRepo)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุงูุฃุณุฆูุฉ ุบูุฑ ุงููุฌุงุจุฉ
- **ุงููุณุคูููุงุช**:
  - ุชุณุฌูู ุงูุฃุณุฆูุฉ
  - ุชุชุจุน ุงูุญุงูุฉ
  - ุฅุฏุงุฑุฉ ุงูุชุญููู
  - ุชูุณูู ุงูุชุญุณูู

#### ุฏ) ูุณุชูุฏุน ุงูุชุนูููุงุช (InstructionRepo)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุจูุงูุงุช ุงูุชุนูููุงุช
- **ุงููุณุคูููุงุช**:
  - ุญูุธ ุงูุชุนูููุงุช
  - ุงุณุชุฑุฌุงุน ุงูููุงุนุฏ
  - ุชุญุฏูุซ ุงูุชูุฌููุงุช
  - ุฅุฏุงุฑุฉ ุงูุฅุตุฏุงุฑุงุช

#### ูู) ูุณุชูุฏุน ุงูุชุงุฌุฑ (MerchantRepo)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุจูุงูุงุช ุงูุชุฌุงุฑ
- **ุงููุณุคูููุงุช**:
  - ุญูุธ ุจูุงูุงุช ุงูุชุฌุงุฑ
  - ุงุณุชุฑุฌุงุน ุงููุนูููุงุช
  - ุชุญุฏูุซ ุงูุฅุนุฏุงุฏุงุช
  - ุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช

#### ู) ูุณุชูุฏุน ุงูุณูุงุณุงุช (PolicyRepo)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุณูุงุณุงุช ุงููุธุงู
- **ุงููุณุคูููุงุช**:
  - ุญูุธ ุงูุณูุงุณุงุช
  - ุงุณุชุฑุฌุงุน ุงูููุงุนุฏ
  - ุชุญุฏูุซ ุงูุฅุนุฏุงุฏุงุช
  - ุฅุฏุงุฑุฉ ุงูุงูุชุซุงู

#### ุฒ) ูุณุชูุฏุน ุงูููุชุฌุงุช (ProductRepo)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุจูุงูุงุช ุงูููุชุฌุงุช
- **ุงููุณุคูููุงุช**:
  - ุญูุธ ุงูููุชุฌุงุช
  - ุงุณุชุฑุฌุงุน ุงูุจูุงูุงุช
  - ุชุญุฏูุซ ุงููุนูููุงุช
  - ุฅุฏุงุฑุฉ ุงูููุฑุณุฉ

#### ุญ) ูุณุชูุฏุน ุงููุนุฑูุฉ (KnowledgeRepo)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุจูุงูุงุช ุงููุนุฑูุฉ
- **ุงููุณุคูููุงุช**:
  - ุญูุธ ุงููุนุฑูุฉ
  - ุงุณุชุฑุฌุงุน ุงููุนูููุงุช
  - ุชุญุฏูุซ ุงููุญุชูู
  - ุฅุฏุงุฑุฉ ุงูููุฑุณุฉ

#### ุท) ูุณุชูุฏุน ุงูููุงู (JobRepo)

- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ุงูููุงู ูุงููุธุงุฆู
- **ุงููุณุคูููุงุช**:
  - ุญูุธ ุงูููุงู
  - ุชุชุจุน ุงูุญุงูุฉ
  - ุฅุฏุงุฑุฉ ุงูุชูููุฐ
  - ุชูุณูู ุงูุนูููุงุช

---

## ๐ ุงูุชูุงุนูุงุช ุจูู ุงูููููุงุช

### 1. ุชูุงุนูุงุช ุงููุชุญููุงุช ูุน ุงูุฎุฏูุงุช

- **ChannelWebhookController** โ **WebhookSignatureVerifier**: ุงูุชุญูู ูู ุงูุชูููุน
- **ChannelWebhookController** โ **ConversationService**: ูุนุงูุฌุฉ ุงูุฑุณุงุฆู
- **ConversationsController** โ **ConversationService**: ุฅุฏุงุฑุฉ ุงููุญุงุฏุซุงุช
- **ConversationsController** โ **ConversationPolicyGuard**: ุชุทุจูู ุงูุณูุงุณุงุช
- **ConversationPolicyGuard** โ **AIOrchestratorClient**: ุชูุณูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู

### 2. ุชูุงุนูุงุช ุงูุฎุฏูุงุช ูุน ุจุนุถูุง ุงูุจุนุถ

- **ProductSearchService** โ **VectorService**: ุงูุจุญุซ ูู ุงููุชุฌูุงุช
- **KnowledgeService** โ **VectorService**: ุงูุจุญุซ ูู ุงููุนุฑูุฉ
- **VectorService** โ **EmbeddingClient**: ุชูููุฏ ุงููุชุฌูุงุช
- **KnowledgeService** โ **ExtractorClient**: ุงุณุชุฎุฑุงุฌ ุงููุญุชูู

### 3. ุชูุงุนูุงุช ุงูุฎุฏูุงุช ูุน ุงููุณุชูุฏุนุงุช

- **ConversationService** โ **ConversationRepo**: ุฅุฏุงุฑุฉ ุงููุญุงุฏุซุงุช
- **ProductSearchService** โ **ProductRepo**: ุงูุจุญุซ ูู ุงูููุชุฌุงุช
- **KnowledgeService** โ **KnowledgeRepo**: ุฅุฏุงุฑุฉ ุงููุนุฑูุฉ
- **PaymentsService** โ **MerchantRepo**: ุฅุฏุงุฑุฉ ุจูุงูุงุช ุงูุชุงุฌุฑ

### 4. ุชูุงุนูุงุช ุงูุฎุฏูุงุช ูุน ุงูุฃูุธูุฉ ุงูุฎุงุฑุฌูุฉ

- **AIOrchestratorClient** โ **LLM Provider**: ุงุณุชุฎุฏุงู ููุงุฐุฌ ุงููุบุฉ
- **EmbeddingClient** โ **Embedding Service**: ุชูููุฏ ุงููุชุฌูุงุช
- **ExtractorClient** โ **Extractor Service**: ุงุณุชุฎุฑุงุฌ ุงููุญุชูู
- **IntegrationsService** โ **Salla/Zid/Shopify**: ูุฒุงููุฉ ุงูุจูุงูุงุช

---

## ๐ ูุฎุทุท ุงูููููุงุช (Component Diagram)

```mermaid
graph TB
    %% ุงููุณุชุฎุฏููู ูุงูุฃูุธูุฉ ุงูุฎุงุฑุฌูุฉ
    Merchant[("๐จโ๐ผ ุงูุชุงุฌุฑ")]
    Shopper[("๐ ุงูุนููู")]
    PlatformAdmin[("๐จโ๐ป ุงูุฃุฏูู ุงูุนุงู")]
    WhatsApp[("๐ฑ WhatsApp")]
    Telegram[("๐ฑ Telegram")]
    Salla[("๐๏ธ Salla")]
    Zid[("๐๏ธ Zid")]
    Shopify[("๐๏ธ Shopify")]
    Payment[("๐ณ Payment Gateway")]
    LLM[("๐ค LLM Provider")]
    MerchantSite[("๐ Merchant Website")]

    %% API ุงูุฑุฆูุณู
    subgraph API["๐ง API ุงูุฑุฆูุณู (NestJS)"]
        %% ุทุจูุฉ ุงูุชุญูู
        subgraph Controllers["๐ฎ ุทุจูุฉ ุงูุชุญูู (Controllers)"]
            ChannelWebhook["๐จ ChannelWebhookController<br/>Webhook ูููููุงุช"]
            WebChat["๐ฌ WebChatController<br/>ุฌูุณุงุช ุงูููุจ ุดุงุช"]
            Conversations["๐ฃ๏ธ ConversationsController<br/>ุฅุฏุงุฑุฉ ุงููุญุงุฏุซุงุช"]
            Training["๐ TrainingController<br/>ุชูููู/ุชุฏุฑูุจ"]
            Knowledge["๐ KnowledgeController<br/>ูุซุงุฆู/FAQ/ููุฑุณุฉ"]
            Products["๐๏ธ ProductsController<br/>ุจุญุซ/ุชูุงุตูู/ููุฑุณุฉ ููุชุฌุงุช"]
            Storefront["๐ StorefrontController<br/>ุณูุฉ/ุทูุจุงุช/ูุฏููุนุงุช"]
            Payments["๐ณ PaymentsController<br/>ุจูุงุจุฉ ุงูุฏูุน"]
            Integrations["๐ IntegrationsController<br/>Salla/Zid/Shopify Auth/Sync"]
            Admin["๐จโ๐ป AdminController<br/>ุฅุนุฏุงุฏุงุช ุนุงูุฉ/ุชูุงุฑูุฑ"]
        end

        %% ุทุจูุฉ ุงูุฎุฏูุงุช
        subgraph Services["โ๏ธ ุทุจูุฉ ุงูุฎุฏูุงุช (Services)"]
            ConversationService["๐ฃ๏ธ ConversationService<br/>ุฅุฏุงุฑุฉ ุงููุญุงุฏุซุงุช"]
            ConversationPolicyGuard["๐ก๏ธ ConversationPolicyGuard<br/>ุญุงุฑุณ ุงูุณูุงุณุงุช"]
            HandoffService["๐ค HandoffService<br/>ุชุณููู ุงููุญุงุฏุซุงุช"]
            AIOrchestratorClient["๐ค AIOrchestratorClient<br/>ุนููู ููุณู ุงูุฐูุงุก ุงูุงุตุทูุงุนู"]
            ToolRegistryService["๐ง ToolRegistryService<br/>ุณุฌู ุงูุฃุฏูุงุช"]
            KnowledgeService["๐ KnowledgeService<br/>ุฎุฏูุฉ ุงููุนุฑูุฉ"]
            ProductSearchService["๐ ProductSearchService<br/>ุจุญุซ ุงูููุชุฌุงุช"]
            VectorService["๐งฎ VectorService<br/>ุฎุฏูุฉ ุงููุชุฌูุงุช"]
            EmbeddingClient["๐ง EmbeddingClient<br/>ุนููู ุงูุชุถููู"]
            ExtractorClient["๐ ExtractorClient<br/>ุนููู ุงูุงุณุชุฎุฑุงุฌ"]
            FeedbackService["โญ FeedbackService<br/>ุฎุฏูุฉ ุงูุชูููู"]
            InstructionService["๐ InstructionService<br/>ุฎุฏูุฉ ุงูุชุนูููุงุช"]
            RerankerService["๐ RerankerService<br/>ุฎุฏูุฉ ุฅุนุงุฏุฉ ุงูุชุฑุชูุจ"]
            PaymentsService["๐ณ PaymentsService<br/>ุฎุฏูุฉ ุงููุฏููุนุงุช"]
            IntegrationsService["๐ IntegrationsService<br/>ุฎุฏูุฉ ุงูุชูุงููุงุช"]
            CacheService["โก CacheService<br/>ุฎุฏูุฉ ุงูุชุฎุฒูู ุงููุคูุช"]
            EventBus["๐ก EventBus<br/>ุญุงููุฉ ุงูุฃุญุฏุงุซ"]
            AuditLogger["๐ AuditLogger<br/>ูุณุฌู ุงูุชุฏููู"]
            WebhookSignatureVerifier["๐ WebhookSignatureVerifier<br/>ูุญูู ุชูููุน Webhook"]
            IdempotencyStore["๐ IdempotencyStore<br/>ูุชุฌุฑ ุนุฏู ุงูุชูุฑุงุฑ"]
        end

        %% ุทุจูุฉ ุงููุณุชูุฏุนุงุช
        subgraph Repositories["๐๏ธ ุทุจูุฉ ุงููุณุชูุฏุนุงุช (Repositories)"]
            ConversationRepo["๐ฃ๏ธ ConversationRepo<br/>ูุณุชูุฏุน ุงููุญุงุฏุซุงุช"]
            MessageRepo["๐ฌ MessageRepo<br/>ูุณุชูุฏุน ุงูุฑุณุงุฆู"]
            UnansweredRepo["โ UnansweredRepo<br/>ูุณุชูุฏุน ุบูุฑ ุงููุฌุงุจ"]
            InstructionRepo["๐ InstructionRepo<br/>ูุณุชูุฏุน ุงูุชุนูููุงุช"]
            MerchantRepo["๐จโ๐ผ MerchantRepo<br/>ูุณุชูุฏุน ุงูุชุงุฌุฑ"]
            PolicyRepo["๐ PolicyRepo<br/>ูุณุชูุฏุน ุงูุณูุงุณุงุช"]
            ProductRepo["๐๏ธ ProductRepo<br/>ูุณุชูุฏุน ุงูููุชุฌุงุช"]
            KnowledgeRepo["๐ KnowledgeRepo<br/>ูุณุชูุฏุน ุงููุนุฑูุฉ"]
            JobRepo["โ๏ธ JobRepo<br/>ูุณุชูุฏุน ุงูููุงู"]
        end
    end

    %% ุงูุชูุงุนูุงุช ุงูุฑุฆูุณูุฉ
    PlatformAdmin --> Admin
    Merchant --> Products
    Merchant --> Storefront
    Shopper --> WebChat
    Shopper --> Storefront

    %% ุชูุงุนูุงุช ุงููุชุญููุงุช ูุน ุงูุฎุฏูุงุช
    ChannelWebhook --> WebhookSignatureVerifier
    ChannelWebhook --> ConversationService
    WebChat --> ConversationService
    Conversations --> ConversationService
    Conversations --> ConversationPolicyGuard
    ConversationPolicyGuard --> AIOrchestratorClient
    Training --> FeedbackService
    Knowledge --> KnowledgeService
    Products --> ProductSearchService
    Storefront --> PaymentsService
    Payments --> PaymentsService
    Integrations --> IntegrationsService
    Admin --> AuditLogger

    %% ุชูุงุนูุงุช ุงูุฎุฏูุงุช ูุน ุจุนุถูุง ุงูุจุนุถ
    ProductSearchService --> VectorService
    KnowledgeService --> VectorService
    VectorService --> EmbeddingClient
    KnowledgeService --> ExtractorClient
    ConversationService --> HandoffService
    AIOrchestratorClient --> ToolRegistryService
    ProductSearchService --> RerankerService
    KnowledgeService --> RerankerService

    %% ุชูุงุนูุงุช ุงูุฎุฏูุงุช ูุน ุงููุณุชูุฏุนุงุช
    ConversationService --> ConversationRepo
    ConversationService --> MessageRepo
    ProductSearchService --> ProductRepo
    KnowledgeService --> KnowledgeRepo
    PaymentsService --> MerchantRepo
    ConversationPolicyGuard --> PolicyRepo
    Training --> UnansweredRepo
    InstructionService --> InstructionRepo
    EventBus --> JobRepo

    %% ุชูุงุนูุงุช ุฎุงุฑุฌูุฉ
    WhatsApp --> ChannelWebhook
    Telegram --> ChannelWebhook
    Salla <--> IntegrationsService
    Zid <--> IntegrationsService
    Shopify <--> IntegrationsService
    Payment <--> PaymentsService
    AIOrchestratorClient <--> LLM
    EmbeddingClient <--> EmbeddingService
    ExtractorClient <--> ExtractorService
    MerchantSite --> WebChat

    %% ุงูุชูุณูู
    classDef userClass fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef externalClass fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef controllerClass fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef serviceClass fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef repoClass fill:#fff8e1,stroke:#f57c00,stroke-width:2px

    class Merchant,Shopper,PlatformAdmin userClass
    class WhatsApp,Telegram,Salla,Zid,Shopify,Payment,LLM,MerchantSite externalClass
    class ChannelWebhook,WebChat,Conversations,Training,Knowledge,Products,Storefront,Payments,Integrations,Admin controllerClass
    class ConversationService,ConversationPolicyGuard,HandoffService,AIOrchestratorClient,ToolRegistryService,KnowledgeService,ProductSearchService,VectorService,EmbeddingClient,ExtractorClient,FeedbackService,InstructionService,RerankerService,PaymentsService,IntegrationsService,CacheService,EventBus,AuditLogger,WebhookSignatureVerifier,IdempotencyStore serviceClass
    class ConversationRepo,MessageRepo,UnansweredRepo,InstructionRepo,MerchantRepo,PolicyRepo,ProductRepo,KnowledgeRepo,JobRepo repoClass
```

---

## ๐ง ุงูุชูุงุตูู ุงูุชูููุฉ

### 1. ุชูููุงุช ุทุจูุฉ ุงูุชุญูู

- **NestJS Controllers**: ุฅุฏุงุฑุฉ ุงูุทูุจุงุช ูุงูุงุณุชุฌุงุจุงุช
- **Decorators**: ุชูุณูู ุงูุนูููุงุช
- **Validation**: ุงูุชุญูู ูู ุงูุจูุงูุงุช
- **Exception Handling**: ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

### 2. ุชูููุงุช ุทุจูุฉ ุงูุฎุฏูุงุช

- **Dependency Injection**: ุฅุฏุงุฑุฉ ุงูุชุจุนูุงุช
- **Business Logic**: ููุทู ุงูุฃุนูุงู
- **Error Handling**: ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- **Logging**: ุชุณุฌูู ุงูุนูููุงุช

### 3. ุชูููุงุช ุทุจูุฉ ุงููุณุชูุฏุนุงุช

- **Repository Pattern**: ููุท ุงููุณุชูุฏุน
- **Data Access**: ุงููุตูู ููุจูุงูุงุช
- **Query Optimization**: ุชุญุณูู ุงูุงุณุชุนูุงูุงุช
- **Caching**: ุงูุชุฎุฒูู ุงููุคูุช

---

## ๐ ูุคุดุฑุงุช ุงูุฃุฏุงุก

### 1. ูุคุดุฑุงุช ุทุจูุฉ ุงูุชุญูู

- **ููุช ุงูุงุณุชุฌุงุจุฉ**: < 100ms
- **ูุนุฏู ุงูุฎุทุฃ**: < 0.1%
- **ุงูุฅูุชุงุฌูุฉ**: > 1000 ุทูุจ/ุฏูููุฉ

### 2. ูุคุดุฑุงุช ุทุจูุฉ ุงูุฎุฏูุงุช

- **ููุช ุงููุนุงูุฌุฉ**: < 500ms
- **ูุนุฏู ุงููุฌุงุญ**: > 99%
- **ุงูุฐุงูุฑุฉ**: < 512MB

### 3. ูุคุดุฑุงุช ุทุจูุฉ ุงููุณุชูุฏุนุงุช

- **ููุช ุงูุงุณุชุนูุงู**: < 50ms
- **ูุนุฏู ุงูุชููุฑ**: > 99.9%
- **ุณุนุฉ ุงูุชุฎุฒูู**: ูุงุจูุฉ ููุชูุณุน

---

## ๐ ุงูุฃูุงู

### 1. ุฃูุงู ุทุจูุฉ ุงูุชุญูู

- **Input Validation**: ุงูุชุญูู ูู ุงููุฏุฎูุงุช
- **Rate Limiting**: ุชุญุฏูุฏ ูุนุฏู ุงูุทูุจุงุช
- **Authentication**: ุงููุตุงุฏูุฉ
- **Authorization**: ุงูุชูููุถ

### 2. ุฃูุงู ุทุจูุฉ ุงูุฎุฏูุงุช

- **Data Encryption**: ุชุดููุฑ ุงูุจูุงูุงุช
- **Access Control**: ุชุญูู ูู ุงููุตูู
- **Audit Logging**: ุชุณุฌูู ุงูุชุฏููู
- **Error Handling**: ูุนุงูุฌุฉ ุขููุฉ ููุฃุฎุทุงุก

### 3. ุฃูุงู ุทุจูุฉ ุงููุณุชูุฏุนุงุช

- **SQL Injection Prevention**: ููุน ุญูู SQL
- **Data Validation**: ุงูุชุญูู ูู ุงูุจูุงูุงุช
- **Access Logging**: ุชุณุฌูู ุงููุตูู
- **Backup Security**: ุฃูุงู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ

---

## ๐ ุงูุชุทููุฑ ุงููุณุชูุจูู

### 1. ุชุญุณููุงุช ูุตูุฑุฉ ุงููุฏู

- ุชุญุณูู ุฃุฏุงุก ุงูุฎุฏูุงุช
- ุฅุถุงูุฉ ููุฒุงุช ุฌุฏูุฏุฉ
- ุชุญุณูู ุงูุฃูุงู

### 2. ุชุญุณููุงุช ูุชูุณุทุฉ ุงููุฏู

- ุฏุนู ุงููุฒูุฏ ูู ุงูุชูุงููุงุช
- ุชุญุณูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู
- ุฅุถุงูุฉ ุชุญูููุงุช ูุชูุฏูุฉ

### 3. ุชุญุณููุงุช ุทูููุฉ ุงููุฏู

- ุฏุนู ูุชุนุฏุฏ ุงูููุงุทู
- ุฐูุงุก ุงุตุทูุงุนู ูุชูุฏู
- ููุตุฉ ูุงุจูุฉ ููุชูุณุน

---

_ุขุฎุฑ ุชุญุฏูุซ: ุฏูุณูุจุฑ 2024_  
_ุงูุฅุตุฏุงุฑ: 1.0.0_
