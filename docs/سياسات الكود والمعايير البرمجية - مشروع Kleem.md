# سياسات الكود والمعايير البرمجية - مشروع Kleem

**تاريخ الإنشاء:** 5 أغسطس 2025  
**الإصدار:** 1.0  
**المشروع:** منصة Kleem للذكاء الاصطناعي التجاري

## المقدمة

تهدف هذه الوثيقة إلى وضع معايير وسياسات واضحة لكتابة الكود في مشروع Kleem، مما يضمن جودة عالية وقابلية للصيانة والتطوير المستقبلي. تم تصميم هذه المعايير بناءً على أفضل الممارسات في صناعة البرمجيات وخصوصيات مشروع Kleem كمنصة ذكاء اصطناعي متقدمة تدعم اللغة العربية.

يعتبر الالتزام بهذه المعايير أمراً أساسياً لضمان تناسق الكود عبر جميع أجزاء المشروع، وتسهيل عملية المراجعة والصيانة، وتقليل الأخطاء البرمجية. كما تساعد هذه المعايير في تسريع عملية تطوير الميزات الجديدة وتحسين تجربة المطورين الجدد الذين ينضمون للفريق.




## المعايير العامة للبرمجة

### فلسفة الكود النظيف

يجب أن يكون الكود في مشروع Kleem واضحاً ومفهوماً لأي مطور يقرأه، حتى لو لم يكن مؤلفه الأصلي. الكود النظيف يعبر عن نفسه بوضوح ولا يحتاج إلى تعليقات مفرطة لفهمه. يجب أن تكون الدوال صغيرة ومركزة على مهمة واحدة، والمتغيرات ذات أسماء واضحة تعبر عن محتواها.

في سياق مشروع Kleem، يكتسب الكود النظيف أهمية خاصة نظراً لتعقيد النظام الذي يتعامل مع الذكاء الاصطناعي ومعالجة اللغة العربية. كل جزء من الكود يجب أن يكون مصمماً ليكون قابلاً للاختبار والتطوير المستقبلي، خاصة مع التطور السريع في تقنيات الذكاء الاصطناعي.

### مبادئ التصميم الأساسية

يجب الالتزام بمبادئ SOLID في التصميم، والتي تشمل مبدأ المسؤولية الواحدة حيث كل كلاس أو دالة تركز على مهمة واحدة فقط. مبدأ الانفتاح والإغلاق يضمن أن الكود مفتوح للتوسيع ولكن مغلق للتعديل، مما يقلل من مخاطر كسر الوظائف الموجودة عند إضافة ميزات جديدة.

مبدأ استبدال ليسكوف يضمن أن الكلاسات المشتقة يمكن استخدامها مكان الكلاسات الأساسية دون كسر وظائف النظام. مبدأ فصل الواجهات يؤكد على أن الواجهات يجب أن تكون محددة ومركزة، وأخيراً مبدأ عكس التبعية الذي يضمن أن الوحدات عالية المستوى لا تعتمد على وحدات منخفضة المستوى.

### إدارة التعقيد

نظراً لطبيعة مشروع Kleem المعقدة التي تتضمن معالجة اللغة الطبيعية والذكاء الاصطناعي، يجب تقسيم المشاكل المعقدة إلى أجزاء صغيرة قابلة للإدارة. كل وحدة يجب أن تكون مستقلة قدر الإمكان مع واجهات واضحة للتفاعل مع الوحدات الأخرى.

يجب تجنب التعقيد غير الضروري في التصميم، والتركيز على الحلول البسيطة والفعالة. عندما يكون التعقيد ضرورياً، يجب توثيقه بوضوح وتوفير أمثلة على كيفية استخدامه. هذا مهم بشكل خاص في أجزاء النظام التي تتعامل مع نماذج الذكاء الاصطناعي ومعالجة النصوص العربية.


## معايير TypeScript للباك إند (NestJS)

### تسمية الملفات والمجلدات

يجب أن تتبع أسماء الملفات نمط kebab-case مع إضافة اللاحقة المناسبة لنوع الملف. على سبيل المثال، `user.controller.ts` للكنترولرز، `chat.service.ts` للخدمات، `workflow.entity.ts` للكيانات، و `auth.guard.ts` للحراس. هذا النمط يضمن الوضوح والتناسق عبر جميع أجزاء المشروع.

أسماء المجلدات يجب أن تكون بصيغة kebab-case أيضاً وتعبر عن الوظيفة الأساسية للوحدة. مثل `chat-management`، `user-authentication`، `workflow-engine`، و `ai-integration`. يجب تجنب الأسماء العامة مثل `utils` أو `helpers` واستخدام أسماء أكثر تحديداً مثل `text-processing-utils` أو `arabic-language-helpers`.

### تسمية المتغيرات والدوال

يجب استخدام camelCase لتسمية المتغيرات والدوال، مع البدء بحرف صغير. الأسماء يجب أن تكون وصفية وتعبر عن الغرض من المتغير أو الدالة. مثل `userChatHistory` بدلاً من `data`، أو `processArabicText` بدلاً من `process`. هذا مهم بشكل خاص في مشروع Kleem حيث نتعامل مع مفاهيم معقدة مثل معالجة اللغة والذكاء الاصطناعي.

للثوابت، يجب استخدام SCREAMING_SNAKE_CASE مثل `MAX_CHAT_HISTORY_LENGTH` أو `DEFAULT_AI_MODEL_TEMPERATURE`. للكلاسات والواجهات، يجب استخدام PascalCase مثل `ChatService` أو `UserInterface`. للأنواع المخصصة، يجب إضافة لاحقة Type مثل `ChatMessageType` أو `WorkflowConfigType`.

### بنية الكلاسات والواجهات

كل كلاس يجب أن يكون له مسؤولية واحدة واضحة ومحددة. في سياق NestJS، الكنترولرز يجب أن تركز على التعامل مع HTTP requests والاستجابات، بينما الخدمات تحتوي على منطق العمل الأساسي. الكيانات تمثل نماذج البيانات، والحراس يتعاملون مع المصادقة والتفويض.

يجب ترتيب أعضاء الكلاس بطريقة منطقية: الخصائص أولاً، ثم الكونستركتور، ثم الدوال العامة، وأخيراً الدوال الخاصة. كل دالة يجب أن تكون صغيرة ومركزة على مهمة واحدة. إذا كانت الدالة تحتوي على أكثر من 20 سطر، يجب النظر في تقسيمها إلى دوال أصغر.

### إدارة الأخطاء والاستثناءات

يجب استخدام نظام إدارة الأخطاء المدمج في NestJS بطريقة متسقة عبر جميع أجزاء التطبيق. كل خطأ يجب أن يكون له نوع محدد ورسالة واضحة تساعد في التشخيص والإصلاح. في مشروع Kleem، هذا مهم بشكل خاص عند التعامل مع أخطاء الذكاء الاصطناعي أو مشاكل معالجة النصوص العربية.

يجب إنشاء كلاسات مخصصة للأخطاء الشائعة مثل `ArabicTextProcessingError` أو `AIModelConnectionError`. كل خطأ يجب أن يحتوي على معلومات كافية للمطور لفهم سبب الخطأ وكيفية إصلاحه. يجب تجنب الأخطاء العامة واستخدام أخطاء محددة ووصفية.

### التعامل مع قواعد البيانات

عند استخدام MongoDB مع Mongoose في مشروع Kleem، يجب تعريف الـ schemas بطريقة واضحة ومنظمة. كل schema يجب أن يحتوي على validation مناسب للبيانات، خاصة للنصوص العربية التي قد تحتاج إلى معالجة خاصة. يجب استخدام indexes مناسبة لتحسين الأداء، خاصة للاستعلامات الشائعة مثل البحث في تاريخ المحادثات.

يجب تجنب الاستعلامات المعقدة في الكنترولرز ونقلها إلى طبقة الخدمات أو إنشاء repositories مخصصة. كل استعلام يجب أن يكون محسناً للأداء ومختبراً جيداً. عند التعامل مع البيانات الحساسة مثل محادثات العملاء، يجب التأكد من تطبيق مبادئ الأمان المناسبة.


## معايير React للفرونت إند

### بنية المكونات والملفات

يجب تنظيم مكونات React في مجلدات منطقية تعكس وظيفة كل مكون. المكونات الأساسية مثل `ChatWidget` أو `UserDashboard` يجب أن تكون في مجلدات منفصلة تحتوي على الملف الرئيسي، ملف الأنماط، ملف الاختبارات، وأي مكونات فرعية. هذا التنظيم يسهل الصيانة والتطوير المستقبلي.

أسماء المكونات يجب أن تستخدم PascalCase وتكون وصفية. مثل `ArabicChatInterface` بدلاً من `Chat`، أو `WorkflowConfigurationPanel` بدلاً من `Config`. كل مكون يجب أن يكون له غرض واحد واضح ومحدد. إذا كان المكون يقوم بأكثر من وظيفة، يجب تقسيمه إلى مكونات أصغر.

### إدارة الحالة (State Management)

في مشروع Kleem، يجب استخدام نمط إدارة الحالة المناسب لكل مستوى من التطبيق. للحالة المحلية البسيطة، يمكن استخدام useState. للحالة المعقدة داخل المكون، يفضل استخدام useReducer. للحالة المشتركة بين عدة مكونات، يجب استخدام Context API أو مكتبة إدارة حالة مثل Zustand أو Redux Toolkit.

بالنسبة لمشروع Kleem، الحالة المتعلقة بالمحادثات والذكاء الاصطناعي تحتاج إلى إدارة خاصة. يجب إنشاء contexts مخصصة مثل `ChatContext` للتعامل مع حالة المحادثات، و `AIContext` للتعامل مع حالة نماذج الذكاء الاصطناعي. كل context يجب أن يوفر actions واضحة ومحددة للتفاعل مع الحالة.

### التعامل مع النصوص العربية

نظراً لأن مشروع Kleem يدعم اللغة العربية بشكل أساسي، يجب إيلاء اهتمام خاص للتعامل مع النصوص العربية في الواجهة. يجب استخدام CSS المناسب لدعم الكتابة من اليمين إلى اليسار (RTL)، وضمان أن جميع المكونات تعمل بشكل صحيح مع النصوص العربية.

يجب إنشاء مكونات مخصصة للتعامل مع النصوص العربية مثل `ArabicTextInput` أو `ArabicMessageDisplay`. هذه المكونات يجب أن تتعامل مع خصوصيات اللغة العربية مثل تشكيل النص، اتجاه الكتابة، والخطوط المناسبة. كما يجب التأكد من أن جميع النصوص قابلة للترجمة والتدويل.

### الأداء والتحسين

يجب تحسين أداء مكونات React في مشروع Kleem، خاصة تلك التي تتعامل مع كميات كبيرة من البيانات مثل تاريخ المحادثات أو نتائج الذكاء الاصطناعي. يجب استخدام React.memo للمكونات التي لا تحتاج إلى إعادة رسم متكررة، و useMemo و useCallback لتحسين العمليات المكلفة.

للمكونات التي تعرض قوائم طويلة مثل تاريخ المحادثات، يجب استخدام تقنيات التحميل التدريجي (lazy loading) أو التمرير الافتراضي (virtual scrolling). هذا مهم بشكل خاص في مشروع Kleem حيث قد تكون هناك محادثات طويلة مع العملاء تحتوي على آلاف الرسائل.

### اختبار المكونات

كل مكون React يجب أن يكون له اختبارات شاملة تغطي جميع الحالات المحتملة. يجب استخدام React Testing Library لاختبار سلوك المكونات من منظور المستخدم. الاختبارات يجب أن تركز على ما يراه المستخدم وكيف يتفاعل مع المكون، وليس على التفاصيل التقنية الداخلية.

في مشروع Kleem، يجب إيلاء اهتمام خاص لاختبار المكونات التي تتعامل مع النصوص العربية والذكاء الاصطناعي. يجب إنشاء بيانات اختبار تحتوي على نصوص عربية متنوعة، واختبار سيناريوهات مختلفة مثل الرسائل الطويلة، الرموز التعبيرية، والنصوص المختلطة بين العربية والإنجليزية.


## معايير Git وإدارة الإصدارات

### رسائل الـ Commits

يجب أن تتبع رسائل الـ commits نمط Conventional Commits لضمان الوضوح والتناسق. كل رسالة يجب أن تبدأ بنوع التغيير مثل `feat` للميزات الجديدة، `fix` للإصلاحات، `docs` للتوثيق، `style` للتنسيق، `refactor` لإعادة الهيكلة، `test` للاختبارات، أو `chore` للمهام الإدارية.

مثال على رسائل commits جيدة في مشروع Kleem: `feat(chat): add Arabic text processing for user messages`، `fix(ai): resolve memory leak in conversation context`، `docs(api): update authentication endpoints documentation`. يجب أن تكون الرسالة واضحة ومختصرة، وتشرح ما تم تغييره وليس كيف تم التغيير.

### استراتيجية التفريع (Branching Strategy)

يجب اتباع نموذج Git Flow المعدل ليناسب احتياجات مشروع Kleem. الفرع الرئيسي `main` يحتوي على الكود المستقر والجاهز للإنتاج. فرع `develop` يحتوي على أحدث التطويرات المختبرة. الفروع الفرعية تتبع نمط التسمية: `feature/feature-name`، `bugfix/bug-description`، `hotfix/critical-fix`.

لمشروع Kleem، يجب إنشاء فروع مخصصة للميزات الكبيرة مثل `feature/arabic-nlp-integration` أو `feature/telegram-bot-enhancement`. كل فرع يجب أن يركز على ميزة واحدة أو إصلاح واحد، ويجب دمجه مع الفرع الرئيسي عبر Pull Request بعد المراجعة والاختبار.

### مراجعة الكود (Code Review)

كل Pull Request يجب أن يخضع لمراجعة من قبل مطور آخر على الأقل قبل الدمج. المراجعة يجب أن تركز على جودة الكود، الأمان، الأداء، والالتزام بالمعايير المحددة في هذه الوثيقة. في مشروع Kleem، يجب إيلاء اهتمام خاص لمراجعة الكود المتعلق بمعالجة النصوص العربية والذكاء الاصطناعي.

المراجع يجب أن يتحقق من أن الكود يعمل بشكل صحيح مع النصوص العربية، وأن التكامل مع نماذج الذكاء الاصطناعي آمن وفعال. يجب أيضاً التحقق من أن الكود لا يحتوي على معلومات حساسة مثل مفاتيح API أو كلمات مرور، وأن جميع المتغيرات الحساسة تستخدم متغيرات البيئة.

## التوثيق والتعليقات

### توثيق الكود

يجب توثيق جميع الدوال والكلاسات العامة باستخدام JSDoc أو TSDoc. التوثيق يجب أن يشرح الغرض من الدالة، المعاملات المطلوبة، القيم المرجعة، والاستثناءات المحتملة. في مشروع Kleem، يجب إيلاء اهتمام خاص لتوثيق الدوال التي تتعامل مع الذكاء الاصطناعي ومعالجة النصوص العربية.

مثال على توثيق جيد:

```ts
/**
 * معالجة النص العربي وتحضيره للذكاء الاصطناعي
 * @param arabicText - النص العربي المراد معالجته
 * @param options - خيارات المعالجة الإضافية
 * @returns النص المعالج والجاهز للإرسال للذكاء الاصطناعي
 * @throws {ArabicProcessingError} عند فشل معالجة النص
 */
```

### التعليقات في الكود

يجب استخدام التعليقات بحكمة وتجنب التعليقات الزائدة. الكود الجيد يجب أن يكون واضحاً بذاته. التعليقات يجب أن تشرح "لماذا" وليس "ماذا". في مشروع Kleem، التعليقات مهمة بشكل خاص في الأجزاء المعقدة مثل خوارزميات معالجة اللغة أو تكوين نماذج الذكاء الاصطناعي.

يجب تجنب التعليقات التي تكرر ما يفعله الكود، والتركيز على التعليقات التي تشرح القرارات التصميمية أو التعقيدات التقنية. التعليقات يجب أن تكون محدثة دائماً مع الكود، والتعليقات القديمة أو غير الصحيحة يجب حذفها أو تحديثها.

### وثائق API

جميع endpoints في API يجب أن تكون موثقة باستخدام Swagger/OpenAPI. التوثيق يجب أن يشمل وصف الـ endpoint، المعاملات المطلوبة، أمثلة على الطلبات والاستجابات، ورموز الأخطاء المحتملة. في مشروع Kleem، يجب توثيق endpoints الخاصة بالذكاء الاصطناعي والمحادثات بتفصيل خاص.

كل endpoint يجب أن يحتوي على أمثلة واقعية تستخدم نصوص عربية، وتوضح كيفية التعامل مع الحالات المختلفة مثل الرسائل الطويلة أو النصوص المختلطة. يجب أيضاً توثيق متطلبات المصادقة والتفويض لكل endpoint.